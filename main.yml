version: 0.2

phases:
   install:
      runtime-versions:
         nodejs: 18
   pre_build:
      commands:
         - echo "Installing dependencies - source npm dependencies..."
         - npm install
         - aws --version
   build:
      commands:
         - echo "Build started on $(date)"
         - echo "Running first test codes"
         - echo "Compiling Node.js code"
         - npm run build
         - echo "Build finished. Now moving to S3"
   post_build:
      commands:
         - echo "Build completed on $(date)"
         - ls
         - pwd
         - aws s3 sync build/ s3://${{ secrets.AWS_S3_BUCKET }} --acl public-read

artifacts:
   files:
      - "build/*"

env:
   variables:
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      AWS_S3_BUCKET: ${{ secrets.AWS_S3_BUCKET }}
      AWS_S3_ARTIFACT: ${{ secrets.AWS_S3_ARTIFACT }}
# artifacts:
#    name: aws s3 artifacts
#    files:
#       - "build/*"

# artifacts:
#    files:
#       - ./*
#    discard-paths: yes
